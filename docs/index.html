<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Xin-Wei Huang">
<meta name="dcterms.date" content="2023-04-13">
<meta name="description" content="Lecture of STA667 Advanced Bayesian Inference in 2023 Spring">

<title>A quick tutorial of WinBUGS and R2WinBUGS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A quick tutorial of WinBUGS and R2WinBUGS</h1>
                  <div>
        <div class="description">
          Lecture of STA667 Advanced Bayesian Inference in 2023 Spring
        </div>
      </div>
                </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://scholar.google.com/citations?user=GNz_4loAAAAJ&amp;hl=en" target="_blank">Xin-Wei Huang</a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Department of Biostatistics, University at Buffalo
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 13, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-start-with-winbugs" id="toc-getting-start-with-winbugs" class="nav-link active" data-scroll-target="#getting-start-with-winbugs">Getting start with WinBUGS</a>
  <ul class="collapse">
  <li><a href="#installation-of-winbugs-1.4.3" id="toc-installation-of-winbugs-1.4.3" class="nav-link" data-scroll-target="#installation-of-winbugs-1.4.3">Installation of WinBUGS 1.4.3</a></li>
  <li><a href="#example-syntax-and-operation" id="toc-example-syntax-and-operation" class="nav-link" data-scroll-target="#example-syntax-and-operation">Example: Syntax and operation</a></li>
  <li><a href="#example-use-doodle" id="toc-example-use-doodle" class="nav-link" data-scroll-target="#example-use-doodle">Example: Use doodle</a></li>
  </ul></li>
  <li><a href="#connect-to-r-r2winbugs" id="toc-connect-to-r-r2winbugs" class="nav-link" data-scroll-target="#connect-to-r-r2winbugs">Connect to R: R2WinBUGS</a>
  <ul class="collapse">
  <li><a href="#install-r2winbugs-package" id="toc-install-r2winbugs-package" class="nav-link" data-scroll-target="#install-r2winbugs-package">Install R2WinBUGS package</a></li>
  <li><a href="#school-data-example" id="toc-school-data-example" class="nav-link" data-scroll-target="#school-data-example">School data example</a>
  <ul class="collapse">
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model specification</a></li>
  <li><a href="#load-data-and-initial-values" id="toc-load-data-and-initial-values" class="nav-link" data-scroll-target="#load-data-and-initial-values">Load data and initial values</a></li>
  <li><a href="#run-sampler" id="toc-run-sampler" class="nav-link" data-scroll-target="#run-sampler">Run sampler</a></li>
  <li><a href="#inference-on-mcmc-samples" id="toc-inference-on-mcmc-samples" class="nav-link" data-scroll-target="#inference-on-mcmc-samples">Inference on MCMC samples</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#softwares" id="toc-softwares" class="nav-link" data-scroll-target="#softwares">Softwares</a>
  <ul class="collapse">
  <li><a href="#comparisons" id="toc-comparisons" class="nav-link" data-scroll-target="#comparisons">Comparisons</a></li>
  <li><a href="#intersting-visualization" id="toc-intersting-visualization" class="nav-link" data-scroll-target="#intersting-visualization">Intersting visualization</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="getting-start-with-winbugs" class="level1">
<h1>Getting start with WinBUGS</h1>
<p>The BUGS (Bayesian inference Using Gibbs Sampling) is a project on developing software for the Bayesian analysis of complex statistical models using Markov chain Monte Carlo (MCMC) methods. The project started in 1989 at the <a href="https://www.mrc-bsu.cam.ac.uk/software/bugs/" target="_blank">MRC Biostatistics Unit</a>. WinBUGS is a statistical software based on BUGS project initially released in 1997 by MRC Biostatistics Unit, and Imperial College School of Medicine. It is a GUI for using BUGS program on Windows system. WinBUGS is no longer update since 2007 because the development of OpenBUGS. The latest version of WinBUGS is 1.4.3.</p>
<section id="installation-of-winbugs-1.4.3" class="level2">
<h2 class="anchored" data-anchor-id="installation-of-winbugs-1.4.3">Installation of WinBUGS 1.4.3</h2>
<ol type="1">
<li><p>Download WinBUGS 1.4.3 on your PC:</p>
<ol type="i">
<li><p><a href="https://www.mrc-bsu.cam.ac.uk/wp-content/uploads/2018/11/winbugs143_unrestricted.zip" target="_blank">.zip file</a> for Windows 64 bit or 32 bit. (Recommended)</p></li>
<li><p><a href="https://www.mrc-bsu.cam.ac.uk/wp-content/uploads/WinBUGS14.exe" target="_blank">.exe file</a> for easier installation but 32 bit Windows only.</p></li>
</ol></li>
<li><p>Extract file folder <code>\winbugs143_unrestricted.zip\winbugs14_full_patched\WinBUGS14</code> to a path that you want to store the software, for example <code>C:\Program Files</code>.</p></li>
<li><p>Create a shortcut for <code>WinBUGS14.exe</code> to desktop or start.</p></li>
</ol>
<p>For macOS, please check the <a href="https://www.r-bloggers.com/2012/01/running-r2winbugs-on-a-mac-running-osx/#:~:text=But%2C%20it%20would%20seem%20that,R2WinBUGS%20to%20run%20as%20well" target="_blank">link</a>.</p>
</section>
<section id="example-syntax-and-operation" class="level2">
<h2 class="anchored" data-anchor-id="example-syntax-and-operation">Example: Syntax and operation</h2>
<p>Consider a statistical model <span class="math display">\[
X_i \sim \text{Normal}(\mu,\sigma^2)
\]</span> and given the prior distributions <span class="math inline">\(\mu \sim \text{Normal}(0, 100^2)\)</span> and <span class="math inline">\(1 / {\sigma}^2 \sim \text{Gamma}(0.001, 0.001)\)</span>.</p>
<p>A WinBUGS program consists of three sections: Model, Data, and Initial Values. Define our model in <code>model{...}</code>. Use <code>~</code> to specify probability distributions, or use <code>&lt;-</code> to make transformation of parameters and data. Data will be stored in a list which has the same syntax as R. Initial values are also stored in a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>model{</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    x[i] <span class="sc">~</span> <span class="fu">dnorm</span> (mu, prec)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  mu <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="dv">0</span>, <span class="fl">0.00001</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  prec <span class="sc">~</span> <span class="fu">dgamma</span> (<span class="fl">0.001</span>, <span class="fl">0.001</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  s2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>prec</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">6.62</span>, <span class="fl">6.71</span>, <span class="fl">5.07</span>, <span class="fl">4.39</span>, <span class="fl">5.68</span>, <span class="fl">3.94</span>, <span class="fl">5.83</span>, <span class="fl">2.31</span>, <span class="fl">3.60</span>, <span class="fl">4.64</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fl">1.79</span>, <span class="fl">3.12</span>, <span class="fl">3.46</span>, <span class="fl">8.25</span>, <span class="fl">5.49</span>, <span class="fl">6.49</span>, <span class="fl">2.65</span>, <span class="fl">9.14</span>, <span class="fl">5.31</span>, <span class="fl">6.58</span>))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>( <span class="at">mu=</span><span class="dv">0</span>, <span class="at">prec=</span><span class="dv">1</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: In BUGS, the second parameter of <code>dnorm</code> is the inverse of normal variance.</p>
<p>Now let’s see how to run these codes in WinBUGS. Open WinBUGS and create an empty script (File -&gt; New). <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/01_interface.png?raw=true" class="img-fluid"></p>
<p>Copy the above code and paste them into WinBUGS. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/02_script.png?raw=true" class="img-fluid"></p>
<p>Open the Specification Tool (Model -&gt; Specification), then highlight the model section and do “check model”. If you define your model correctly, it will show “model is syntactically correct” at the bottom left-hand corner. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/03_specify_and_check.png?raw=true" class="img-fluid"></p>
<p>The next step is to load the data. Highlight data section and click “load data”. You will see “data loaded”at the bottom left-hand corner. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/04_load_data.png?raw=true" class="img-fluid"></p>
<p>And then compile the model by click “compile” and look for “model compiled”. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/05_compile.png?raw=true" class="img-fluid"></p>
<p>Similarly, highlight the initial values and click “load inits”. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/06_inits.png?raw=true" class="img-fluid"></p>
<p>Open Sample Monitor Tool (Inference -&gt; Samples), type in the parameters that we are going to monitor, for example “mu” and “s2”, then click “set”. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/07_sampler_par.png?raw=true" class="img-fluid"></p>
<p>Open Update Tool (Model -&gt; Update) and type in how many samples you would like to generate. Click “update” and wait for “updates took x s” message when update done. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/09_update_done.png?raw=true" class="img-fluid"></p>
<p>You can use Sample Monitor Tool to do summary statistics, time series plot for MCMC samples, density curve, etc. <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/10_post.png?raw=true" class="img-fluid"></p>
</section>
<section id="example-use-doodle" class="level2">
<h2 class="anchored" data-anchor-id="example-use-doodle">Example: Use doodle</h2>
<p>DoodleBUGS is a special visualized tool in WinBUGS. You can specify graphical models by doodle, which uses a hyper-diagram approach to add extra information to the graph to give a complete model specification.</p>
<p>First, create a new script for doodle. (Doodle -&gt; New) <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/11_Doodle.png?raw=true" class="img-fluid"></p>
<p>Doodle includes three types of objects: node, plate, and edge. Easily speaking, node uses for specifying parameters and data. Plate is the loop structure. Edge builds the connection between the nodes. Operation on these objects are as follow:</p>

<style scoped="">
table {
  font-size: 13px;
}
</style>
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 26%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Operation</th>
<th style="text-align: center;">Node</th>
<th style="text-align: center;">Plate</th>
<th style="text-align: center;">Edge (A -&gt; B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Creating</td>
<td style="text-align: center;">Click an empty region</td>
<td style="text-align: center;"><code>ctrl</code>+ click an empty region</td>
<td style="text-align: center;">Select B then <code>ctrl</code> + click A</td>
</tr>
<tr class="even">
<td style="text-align: center;">Selecting</td>
<td style="text-align: center;">Click the node</td>
<td style="text-align: center;">Click the bottom or right border</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Deleting</td>
<td style="text-align: center;">Select then <code>del</code></td>
<td style="text-align: center;">Select then <code>ctrl</code> + <code>del</code></td>
<td style="text-align: center;">Select B then <code>ctrl</code> + click A</td>
</tr>
<tr class="even">
<td style="text-align: center;">Moving</td>
<td style="text-align: center;">Select and drag</td>
<td style="text-align: center;">Select then drag the border</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Resizing</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">Select and hold the bottom right corner, then drag</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p><img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/12_Node.png?raw=true" class="img-fluid"></p>
<p>Suppose we have a logistic regression model: <span class="math display">\[y_i|\pi_i \sim \text{Bernoulli}(\pi_i)\]</span> where the logit link is <span class="math inline">\(\text{logit}(\pi_i)=\alpha+\beta x_i\)</span> and the hyper-priors are <span class="math inline">\(\alpha \sim \beta \sim \text{Normal}(0, 10^6)\)</span>. Try to specify the model using doodle. Once finished, the doodle can easily transform to the script of BUGS (Doodle -&gt; Write Code). <img src="https://github.com/XinweiBuffalo/WinBUGS/blob/main/pic/13_Doodel_code.png?raw=true" class="img-fluid"></p>
</section>
</section>
<section id="connect-to-r-r2winbugs" class="level1">
<h1>Connect to R: R2WinBUGS</h1>
<p><code>R2WinBUGS</code> is a package which provides an interface for running WinBUGS on R. The computation still rely on WinBUGS, but coding job can be done in R. It will be much more easier to create BUGS script files, convert data, and analyze posterior MCMC samples.</p>
<section id="install-r2winbugs-package" class="level2">
<h2 class="anchored" data-anchor-id="install-r2winbugs-package">Install R2WinBUGS package</h2>
<p>Use <code>install.packages</code> and <code>library</code> to install and load the package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("R2WinBUGS")</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"R2WinBUGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="school-data-example" class="level2">
<h2 class="anchored" data-anchor-id="school-data-example">School data example</h2>
<p>The Scholastic Aptitude Test (SAT) data comes from the SAT-V (Verbal) on eight different high schools from an experiment <span class="citation" data-cites="rubin1981estimation">Rubin (<a href="#ref-rubin1981estimation" role="doc-biblioref">1981</a>)</span>. The data includes the estimated treatment effects and the corresponding standard error from an ANCOVA. This example was analyzed using a hierarchical normal model: <span class="math display">\[
y_j|\theta_j, \sigma_j^2 \sim \text{Normal}(\theta_j, \sigma_j^2=1/\tau_j)
\]</span> given the priors and hyperpriors <span class="math inline">\(\theta_j \sim \text{N}(\mu_\theta, \sigma_\theta^2=1/\tau_\theta)\)</span>, <span class="math inline">\(\mu_\theta \sim \text{N}(0, 10^6)\)</span>, and <span class="math inline">\(\sigma_\theta \sim \text{U}(0, 1000)\)</span>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_3af8531a9b0e21b96d46e6ac73bde5d4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(schools)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>schools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  school estimate   sd
1      A    28.39 14.9
2      B     7.94 10.2
3      C    -2.75 16.3
4      D     6.82 11.0
5      E    -0.64  9.4
6      F     0.63 11.4
7      G    18.01 10.4
8      H    12.16 17.6</code></pre>
</div>
</div>
<section id="model-specification" class="level3">
<h3 class="anchored" data-anchor-id="model-specification">Model specification</h3>
<p>To specify the model, we use the same syntax as we did in WinBUGS. Then create a <code>.txt</code> or <code>.bug</code> file to store the model at local path. It is also allowed to use a function containing a <code>BUGS</code> model since is has the similar syntax as R. While applying this model, only a temporary file will be created.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_18d1071a23b719f23f82ea7d9c8ba2d5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>J)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    y[j] <span class="sc">~</span> <span class="fu">dnorm</span> (theta[j], tau.y[j])</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    theta[j] <span class="sc">~</span> <span class="fu">dnorm</span> (mu.theta, tau.theta)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    tau.y[j] <span class="ot">&lt;-</span> <span class="fu">pow</span>(sigma.y[j], <span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  mu.theta <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1.0E-6</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  tau.theta <span class="ot">&lt;-</span> <span class="fu">pow</span>(sigma.theta, <span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  sigma.theta <span class="sc">~</span> <span class="fu">dunif</span> (<span class="dv">0</span>, <span class="dv">1000</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: When using truncation specification, <code>%_%</code> will be needed. Check <code>?R2WinBUGS::write.model()</code> for more details.</p>
</section>
<section id="load-data-and-initial-values" class="level3">
<h3 class="anchored" data-anchor-id="load-data-and-initial-values">Load data and initial values</h3>
<p>Data and initial values can be arranged as lists in R script. Save initial values lists to be function avoid repeated specifying values for multiple chains.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_07daaa26d2481ea4b928dbb2a9a3f124">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="fu">nrow</span>(schools)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> schools<span class="sc">$</span>estimate</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>sigma.y <span class="ot">&lt;-</span> schools<span class="sc">$</span>sd</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"J"</span>, <span class="st">"y"</span>, <span class="st">"sigma.y"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">rnorm</span>(J, <span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu.theta =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma.theta =</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="run-sampler" class="level3">
<h3 class="anchored" data-anchor-id="run-sampler">Run sampler</h3>
<p>The sampler function <code>bugs()</code> has many arguments to control the sample generation process. For details, please see <code>?R2WinBUGS::bugs()</code>. The output is a bugs object. We can take the MCMC samples from it and do further inference. ()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>schools.sim <span class="ot">&lt;-</span>  <span class="fu">bugs</span>(<span class="at">data =</span> data,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">inits =</span> inits,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model.file =</span> mod1,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                     parameters.to.save </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                     <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"theta"</span>, <span class="st">"mu.theta"</span>, <span class="st">"sigma.theta"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n.chains =</span> <span class="dv">4</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n.iter =</span> <span class="dv">2000</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bugs.directory =</span> <span class="st">"c:/Program Files/WinBUGS14/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in file(con, "wb") : cannot open the connection</code></pre>
</div>
</div>
<p>Note: If you receive any error message about “Cannot open the connection” or “Permission denied”, please reopen Rstudio with Run as administrator.</p>
</section>
<section id="inference-on-mcmc-samples" class="level3">
<h3 class="anchored" data-anchor-id="inference-on-mcmc-samples">Inference on MCMC samples</h3>
<p>Just show some basic analysis. You can play more on it. Other packages like <code>posterior</code> and <code>mcmc</code> are also suggested.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_57e640cd0ac0e71f043670948703d171">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary statistics</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(schools.sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Bugs model at "C:/Users/Xinwei/AppData/Local/Temp/RtmpuCiakQ/model72dc354f7cfe.txt", fit using WinBUGS,
 4 chains, each with 2000 iterations (first 1000 discarded), n.thin = 4
 n.sims = 1000 iterations saved
            mean  sd  2.5%  25%  50%  75% 97.5% Rhat n.eff
theta[1]    12.4 8.8  -2.1  6.5 11.2 16.7  32.9  1.0   180
theta[2]     8.3 6.6  -3.5  3.6  8.2 12.7  21.3  1.0   160
theta[3]     6.4 8.2  -9.5  1.2  6.5 11.3  21.5  1.0   540
theta[4]     7.8 6.8  -5.3  3.5  7.7 12.5  21.0  1.0   240
theta[5]     5.5 7.2  -9.8  1.2  5.9 10.3  17.3  1.0   170
theta[6]     6.2 7.3 -10.2  1.9  6.4 10.8  18.9  1.0   180
theta[7]    11.1 7.6  -2.0  6.0 10.3 16.3  28.2  1.0   340
theta[8]     9.0 8.1  -7.1  4.0  8.9 13.8  26.5  1.0   240
mu.theta     8.3 5.5  -1.8  4.5  8.1 11.9  18.3  1.0   180
sigma.theta  7.0 5.9   0.1  2.7  5.7  9.6  20.8  1.2    49
deviance    60.7 2.4  56.9 59.1 60.2 61.9  66.6  1.0   130

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = Dbar-Dhat)
pD = 3.1 and DIC = 63.8
DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(schools.sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># time series plot</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(schools.sim<span class="sc">$</span>sims.list<span class="sc">$</span>theta[,<span class="dv">1</span>]<span class="sc">~</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>schools.sim<span class="sc">$</span>n.sims), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"t"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(theta[<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density for theta_1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(schools.sim<span class="sc">$</span>sims.list<span class="sc">$</span>theta[,<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># More inference</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability calculation</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(schools.sim<span class="sc">$</span>sims.list<span class="sc">$</span>theta[,<span class="dv">1</span>]<span class="sc">&gt;</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.565</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the treatment effect</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(schools.sim<span class="sc">$</span>sims.list<span class="sc">$</span>theta[,<span class="dv">1</span>])<span class="sc">&gt;</span><span class="fu">mean</span>(schools.sim<span class="sc">$</span>sims.list<span class="sc">$</span>theta[,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>For more examples, see <span class="citation" data-cites="sturtz2005r2winbugs">Sturtz, Ligges, and Gelman (<a href="#ref-sturtz2005r2winbugs" role="doc-biblioref">2005</a>)</span> and <span class="citation" data-cites="dominici">Dominici (<a href="#ref-dominici" role="doc-biblioref">n.d.</a>)</span></p>
</section>
</section>
</section>
<section id="softwares" class="level1">
<h1>Softwares</h1>
<section id="comparisons" class="level2">
<h2 class="anchored" data-anchor-id="comparisons">Comparisons</h2>
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>BUGS</th>
<th>JAGS</th>
<th>STAN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Algorithms</td>
<td>GS, MH</td>
<td>GS, MH</td>
<td>Hamiltonian MC</td>
</tr>
<tr class="even">
<td>Model complexity</td>
<td>Moderate</td>
<td>Moderate</td>
<td>High</td>
</tr>
<tr class="odd">
<td>Syntax</td>
<td>S</td>
<td>S</td>
<td>C++</td>
</tr>
<tr class="even">
<td>Interface</td>
<td>WinBUGS, OpenBUGS</td>
<td>R</td>
<td>R, Python, MATLAB, etc.</td>
</tr>
<tr class="odd">
<td>R packages</td>
<td>R2WinBUGS</td>
<td>rjags, R2jags</td>
<td>RStan, Cmdstanr</td>
</tr>
<tr class="even">
<td>User Community</td>
<td>Not active</td>
<td>Large and active</td>
<td>Large and active</td>
</tr>
</tbody>
</table>
</section>
<section id="intersting-visualization" class="level2">
<h2 class="anchored" data-anchor-id="intersting-visualization">Intersting visualization</h2>
<p>A very interesting and well-produced web page: <a href="https://chi-feng.github.io/mcmc-demo/app.html" target="_blank">The Markov-chain Monte Carlo Interactive Gallery</a> <span class="citation" data-cites="feng">Feng (<a href="#ref-feng" role="doc-biblioref">n.d.</a>)</span></p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<hr>
<hr>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-dominici" class="csl-entry" role="listitem">
Dominici, Francesca. n.d. <span>“Lab 8: Introduction to WinBUGS.”</span> <em>ML - Bio 656 Lectures</em>. <a href="https://www.biostat.jhsph.edu/~fdominic/teaching/bio656/lectures/lectures.html">https://www.biostat.jhsph.edu/~fdominic/teaching/bio656/lectures/lectures.html</a>.
</div>
<div id="ref-feng" class="csl-entry" role="listitem">
Feng, Chi. n.d. <em>MCMC Interactive Gallery</em>. <a href="https://chi-feng.github.io/mcmc-demo/app.html">https://chi-feng.github.io/mcmc-demo/app.html</a>.
</div>
<div id="ref-rubin1981estimation" class="csl-entry" role="listitem">
Rubin, Donald B. 1981. <span>“Estimation in Parallel Randomized Experiments.”</span> <em>Journal of Educational Statistics</em> 6 (4): 377–401.
</div>
<div id="ref-sturtz2005r2winbugs" class="csl-entry" role="listitem">
Sturtz, Sibylle, Uwe Ligges, and Andrew Gelman. 2005. <span>“R2WinBUGS: A Package for Running WinBUGS from r.”</span> <em>Journal of Statistical Software</em> 12: 1–16.
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>